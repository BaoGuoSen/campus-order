webpackJsonp([4],{"3uYv":function(t,e){},uD1y:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={props:{order:{type:Object,default:function(){return{}}}},name:"",data:function(){return{fit:"cover",statusLabels:["待付款","未完成","已完成"],evaluationDialog:!1,rateSubmit:!0}},computed:{payButton:function(){return 0===this.order.status},confirmButton:function(){return 1===this.order.status},evaluationButton:function(){return 2===this.order.status},time:function(){return new Date(Number(this.order.startTime)).toLocaleString()},src:function(){return[this.order.dishSrc]},title:function(){return this.order.storeName?this.order.storeName:"NULL"}},mounted:function(){this.order.rate&&(this.rateSubmit=!1)},methods:{updateOrderRate:function(){var t=this;this.$axios.post("api/order/updateOrderRate",this.order).then(function(e){t.evaluationDialog=!1,t.$message({message:"提交成功",type:"success"})}).catch(function(e){t.$message.error(e.status+" "+e.error)})},toOrderInfo:function(){this.$router.push({name:"orderInfo",params:{id:this.order.id}})},alipay:function(){var t=this;this.$axios.post("api/pay/confirm",this.order).then(function(e){if(200===e.status){var r=t.$router.resolve({path:"/apply",query:{html:e.data}});window.open(r.href,"_blank")}console.log(e)}).catch(function(e){t.$message.error(e.status+" "+e.error)})},confirm:function(){var t=this;this.$axios.get("/api/order/updateOrderStatusConfirm",{params:{id:this.order.id,endTime:(new Date).getTime()}}).then(function(e){t.order.status=2}).catch(function(e){t.$message.error(e.status+" "+e.error)})}}},i={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"order"},[r("p",{staticClass:"order-storeName"},[t._v(t._s(t.title))]),t._v(" "),r("div",{staticClass:"order-dish"},[r("el-image",{staticStyle:{width:"150px",height:"100px"},attrs:{src:t.order.dishSrc,fit:t.fit,"preview-src-list":t.src}}),t._v(" "),r("p",{staticClass:"order-dishName"},[t._v(t._s(t.order.dishName))])],1),t._v(" "),r("p",{staticClass:"order-time"},[t._v("下单时间: "+t._s(t.time))]),t._v(" "),r("div",{staticClass:"order-button-list"},[t.payButton?r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.alipay()}}},[t._v("立即付款")]):t._e(),t._v(" "),t.confirmButton?r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.confirm()}}},[t._v("确认送达")]):t._e(),t._v(" "),t.evaluationButton?r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.evaluationDialog=!0}}},[t._v("评价")]):t._e(),t._v(" "),r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.toOrderInfo()}}},[t._v("详情")])],1),t._v(" "),r("div",{staticClass:"order-status-contain"},[r("span",{staticClass:"order-status"},[t._v(t._s(t.statusLabels[t.order.status]))])]),t._v(" "),r("el-dialog",{attrs:{title:"评价",visible:t.evaluationDialog,modal:!1,width:"40%"},on:{"update:visible":function(e){t.evaluationDialog=e}}},[r("span",{staticStyle:{float:"left"}},[t._v("评分:")]),t._v(" "),r("el-rate",{attrs:{"show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:t.order.rate,callback:function(e){t.$set(t.order,"rate",e)},expression:"order.rate"}}),t._v(" "),r("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:t.order.customerEvaluate,callback:function(e){t.$set(t.order,"customerEvaluate",e)},expression:"order.customerEvaluate"}}),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.evaluationDialog=!1}}},[t._v("取消")]),t._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:t.evaluationDialog&&t.rateSubmit,expression:"evaluationDialog && rateSubmit"}],attrs:{type:"primary"},on:{click:function(e){return t.updateOrderRate()}}},[t._v("提交")])],1)],1)],1)])},staticRenderFns:[]};var a={components:{cusOrder:r("VU/8")(s,i,!1,function(t){r("3uYv")},"data-v-3bcfe1eb",null).exports},data:function(){return{activeName:"All",orders:[],curOrders:[],itemHeight:100,screenHeight:0,startOffset:0,start:0,end:null,scrollDebounce:function(){}}},created:function(){this.scrollDebounce=this.debounce(this.scrollEvent,100)},computed:{orderListHeight:function(){return this.curOrders.length*this.itemHeight},visibleCount:function(){return Math.ceil(this.screenHeight/this.itemHeight)},visibleData:function(){return this.curOrders.slice(this.start,Math.min(this.end,this.curOrders.length))},getTransform:function(){return"translate3d(0, "+this.startOffset+"px,0)"}},mounted:function(){this.getOrdersByCusId(),this.screenHeight=550,console.log(this.screenHeight,document.body.clientHeight),this.end=this.start+this.visibleCount},methods:{debounce:function(t,e){var r=null;return function(){var s=this,i=arguments;r&&clearTimeout(r),r=setTimeout(function(){t.apply(s,i)},e)}},scrollEvent:function(t){var e=this.$refs.list.scrollTop;console.log(e),this.start=Math.floor(e/this.itemHeight),this.end=this.start+this.visibleCount,this.startOffset=e-e%this.itemHeight},handleClick:function(){"noPay"===this.activeName?this.curOrders=this.orders.filter(function(t){return 0===t.status}):"noDone"===this.activeName?this.curOrders=this.orders.filter(function(t){return 1===t.status}):"Done"===this.activeName?this.curOrders=this.orders.filter(function(t){return 2===t.status}):this.curOrders=this.orders.filter(function(t){return t.status>=0})},getOrdersByCusId:function(){var t=this;this.$axios.get("api/order/getOrderByCustomerId",{params:{customerId:sessionStorage.getItem("userId")}}).then(function(e){t.orders=e.data,t.curOrders=e.data}).catch(function(e){t.$message.error(e.status+" "+e.error)})}}},n={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-tabs",{staticClass:"cus-taps",on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"待付款",name:"noPay"}}),t._v(" "),r("el-tab-pane",{attrs:{label:"未完成",name:"noDone"}}),t._v(" "),r("el-tab-pane",{attrs:{label:"已完成",name:"Done"}}),t._v(" "),r("el-tab-pane",{attrs:{label:"全部订单",name:"All"}})],1),t._v(" "),r("div",{ref:"list",staticClass:"orderList-contain",on:{scroll:function(e){return t.scrollDebounce()}}},[r("div",{staticClass:"infinite-list-phantom",style:{height:t.orderListHeight+"px"}}),t._v(" "),r("div",{staticClass:"infinite-list",style:{transform:t.getTransform}},t._l(t.visibleData,function(t){return r("cus-order",{key:t.id,staticClass:"orderList",attrs:{order:t}})}),1)])],1)},staticRenderFns:[]};var o=r("VU/8")(a,n,!1,function(t){r("vOuL")},"data-v-3dc4c625",null);e.default=o.exports},vOuL:function(t,e){}});
//# sourceMappingURL=4.8cbef5ef6c1f04da508d.js.map